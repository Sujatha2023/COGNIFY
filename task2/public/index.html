<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Task 2 — Inline Styles & Validation</title>
</head>
<body style="font-family:Segoe UI, Arial, sans-serif; background:#eef4fb; padding:28px;">

  <div style="max-width:920px; margin:0 auto; display:flex; gap:20px;">
    <!-- left card: illustration & title -->
    <div style="flex:1; background:white; border-radius:10px; padding:20px; box-shadow:0 8px 22px rgba(0,0,0,0.06);">
      <h1 style="margin:0 0 8px 0; font-size:22px; color:#0f172a;">Level 1 — Inline Styles & Server Validation</h1>
      <p style="margin:0 0 12px 0; color:#334155;">fill the form</p>
      <div style="font-size:13px; color:#475569;">
        <strong>Features</strong>
        <ul style="margin:8px 0 0 18px; padding:0;">
          <li>Complex form (checkboxes, radio, select, date)</li>
          <li>Inline CSS & inline JS</li>
          <li>Client-side & server-side validation</li>
          <li>Temporary storage (in-memory)</li>
        </ul>
      </div>
    </div>

    <!-- right card: form -->
    <div style="flex:1.25; background:white; border-radius:10px; padding:20px; box-shadow:0 8px 22px rgba(0,0,0,0.06);">
      <form id="applyForm" style="display:block;">
        <div style="display:flex; gap:12px; margin-bottom:12px;">
          <div style="flex:1;">
            <label style="display:block; font-weight:600; margin-bottom:6px;">Name</label>
            <input id="name" name="name" type="text" placeholder="Your name" style="width:100%; padding:8px; border-radius:6px; border:1px solid #cbd5e1;" />
            <div id="err-name" style="color:#b91c1c; font-size:12px; margin-top:6px;"></div>
          </div>
          <div style="width:160px;">
            <label style="display:block; font-weight:600; margin-bottom:6px;">Age</label>
            <input id="age" name="age" type="number" min="0" max="120" style="width:100%; padding:8px; border-radius:6px; border:1px solid #cbd5e1;" />
            <div id="err-age" style="color:#b91c1c; font-size:12px; margin-top:6px;"></div>
          </div>
        </div>

        <div style="margin-bottom:12px;">
          <label style="display:block; font-weight:600; margin-bottom:6px;">Email</label>
          <input id="email" name="email" type="email" placeholder="you@example.com" style="width:100%; padding:8px; border-radius:6px; border:1px solid #cbd5e1;" />
          <div id="err-email" style="color:#b91c1c; font-size:12px; margin-top:6px;"></div>
        </div>

        <div style="margin-bottom:12px;">
          <label style="display:block; font-weight:600; margin-bottom:6px;">Skills (select at least one)</label>
          <div style="display:flex; flex-wrap:wrap; gap:8px;">
            <label style="display:inline-flex; align-items:center; gap:6px; font-size:14px;"><input type="checkbox" name="skills" value="HTML" /> HTML</label>
            <label style="display:inline-flex; align-items:center; gap:6px; font-size:14px;"><input type="checkbox" name="skills" value="CSS" /> CSS</label>
            <label style="display:inline-flex; align-items:center; gap:6px; font-size:14px;"><input type="checkbox" name="skills" value="JavaScript" /> JavaScript</label>
            <label style="display:inline-flex; align-items:center; gap:6px; font-size:14px;"><input type="checkbox" name="skills" value="NodeJS" /> NodeJS</label>
            <label style="display:inline-flex; align-items:center; gap:6px; font-size:14px;"><input id="skill-other" type="checkbox" name="skills" value="Other" /> Other</label>
            <input id="otherSkill" placeholder="Type other skill" style="display:none; padding:6px 8px; border-radius:6px; border:1px solid #cbd5e1;" />
          </div>
          <div id="err-skills" style="color:#b91c1c; font-size:12px; margin-top:6px;"></div>
        </div>

        <div style="display:flex; gap:12px; margin-bottom:12px;">
          <div style="flex:1;">
            <label style="display:block; font-weight:600; margin-bottom:6px;">Experience</label>
            <div>
              <label style="margin-right:8px;"><input type="radio" name="experience" value="Beginner" checked /> Beginner</label>
              <label style="margin-right:8px;"><input type="radio" name="experience" value="Intermediate" /> Intermediate</label>
              <label><input type="radio" name="experience" value="Advanced" /> Advanced</label>
            </div>
          </div>

          <div style="flex:1;">
            <label style="display:block; font-weight:600; margin-bottom:6px;">Preferred Role</label>
            <select id="role" name="role" style="width:100%; padding:8px; border-radius:6px; border:1px solid #cbd5e1;">
              <option value="">Select role</option>
              <option>Frontend</option>
              <option>Backend</option>
              <option>Fullstack</option>
              <option>QA</option>
            </select>
          </div>
        </div>

        <div style="margin-bottom:12px;">
          <label style="display:block; font-weight:600; margin-bottom:6px;">Availability (date)</label>
          <input id="availability" name="availability" type="date" style="padding:8px; border-radius:6px; border:1px solid #cbd5e1;" />
          <div id="err-availability" style="color:#b91c1c; font-size:12px; margin-top:6px;"></div>
        </div>

        <div style="margin-bottom:12px;">
          <label style="display:block; font-weight:600; margin-bottom:6px;">Short message / cover note</label>
          <textarea id="message" name="message" rows="4" style="width:100%; padding:8px; border-radius:6px; border:1px solid #cbd5e1;"></textarea>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:6px;">
            <div id="err-message" style="color:#b91c1c; font-size:12px;"></div>
            <div style="font-size:12px; color:#475569;"><span id="msgCount">0</span>/500</div>
          </div>
        </div>

        <div style="margin-bottom:14px;">
          <label style="display:inline-flex; gap:8px; align-items:center;">
            <input id="terms" name="terms" type="checkbox" /> I accept the terms and conditions
          </label>
          <div id="err-terms" style="color:#b91c1c; font-size:12px; margin-top:6px;"></div>
        </div>

        <div style="display:flex; gap:10px; align-items:center;">
          <button type="submit" style="background:#2563eb; color:white; border:none; padding:10px 14px; border-radius:8px; font-weight:700; cursor:pointer;">Submit</button>
          <div id="result" style="font-weight:700;"></div>
        </div>
      </form>
    </div>
  </div>

  <!-- INLINE JAVASCRIPT -->
  <script>
    // UI elements
    const form = document.getElementById('applyForm');
    const otherSkillCb = document.getElementById('skill-other');
    const otherSkillInput = document.getElementById('otherSkill');
    const msgInput = document.getElementById('message');
    const msgCount = document.getElementById('msgCount');
    const resultDiv = document.getElementById('result');

    // Show/hide "Other" skill input
    otherSkillCb.addEventListener('change', () => {
      otherSkillInput.style.display = otherSkillCb.checked ? 'inline-block' : 'none';
      if (!otherSkillCb.checked) otherSkillInput.value = '';
    });

    // character counter for message
    msgInput.addEventListener('input', () => {
      msgCount.textContent = msgInput.value.length;
      if (msgInput.value.length > 500) msgCount.style.color = 'red'; else msgCount.style.color = '';
    });

    function clearErrors() {
      ['name','email','age','skills','message','availability','terms'].forEach(k => {
        const el = document.getElementById('err-' + k);
        if (el) el.textContent = '';
      });
      resultDiv.textContent = '';
    }

    function clientValidate(payload) {
      const errors = {};
      if (!payload.name || payload.name.trim().length < 2) errors.name = 'Name must be at least 2 characters.';
      if (!payload.email || !/^\S+@\S+\.\S+$/.test(payload.email)) errors.email = 'Enter a valid email.';
      const age = Number(payload.age);
      if (isNaN(age) || age < 0 || age > 120) errors.age = 'Enter a valid age (0–120).';
      if (!payload.skills || payload.skills.length === 0) errors.skills = 'Select at least one skill.';
      if (!payload.availability) errors.availability = 'Select availability date.';
      else {
        const av = new Date(payload.availability); av.setHours(0,0,0,0);
        const today = new Date(); today.setHours(0,0,0,0);
        if (isNaN(av.getTime())) errors.availability = 'Invalid date.';
        else if (av < today) errors.availability = 'Availability cannot be in the past.';
      }
      if (!payload.message || payload.message.trim().length < 10) errors.message = 'Message must be at least 10 characters.';
      if (!payload.termsAccepted) errors.termsAccepted = 'You must accept the terms.';
      return errors;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearErrors();

      // Collect values
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const age = document.getElementById('age').value;
      const availability = document.getElementById('availability').value;
      const role = document.getElementById('role').value;
      const experience = form.querySelector('input[name="experience"]:checked')?.value || '';
      const message = document.getElementById('message').value;
      const termsAccepted = document.getElementById('terms').checked;

      // collect checked skills
      const skillsNodes = Array.from(form.querySelectorAll('input[name="skills"]:checked'));
      let skills = skillsNodes.map(n => n.value);
      if (otherSkillInput.value.trim() && otherSkillCb.checked) {
        skills = skills.filter(s => s !== 'Other');
        skills.push(otherSkillInput.value.trim());
      }

      const payload = { name, email, age, availability, role, experience, message, skills, termsAccepted };

      // client validation
      const errors = clientValidate(payload);
      if (Object.keys(errors).length) {
        Object.entries(errors).forEach(([k,v]) => {
          const target = document.getElementById('err-' + k) || document.getElementById('err-' + (k === 'termsAccepted' ? 'terms' : k));
          if (target) target.textContent = v;
        });
        resultDiv.style.color = 'red';
        resultDiv.textContent = 'Fix the highlighted errors.';
        return;
      }

      resultDiv.style.color = '';
      resultDiv.textContent = 'Submitting...';

      // send to server
      try {
        const res = await fetch('/api/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const json = await res.json();
        if (!res.ok) {
          if (json.errors) {
            Object.entries(json.errors).forEach(([k,v]) => {
              const target = document.getElementById('err-' + k) || document.getElementById('err-' + (k === 'termsAccepted' ? 'terms' : k));
              if (target) target.textContent = v;
            });
            resultDiv.style.color = 'red';
            resultDiv.textContent = 'Server validation failed.';
          } else {
            resultDiv.style.color = 'red';
            resultDiv.textContent = 'Server error: ' + (json.message || res.statusText);
          }
        } else {
          resultDiv.style.color = 'green';
          resultDiv.textContent = 'Success! Your submission id: ' + json.record.id;
          form.reset();
          otherSkillInput.style.display = 'none';
          msgCount.textContent = '0';
        }
      } catch (err) {
        console.error(err);
        resultDiv.style.color = 'red';
        resultDiv.textContent = 'Network or server error (see console).';
      }
    });
  </script>
</body>
</html>